<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Winter AR â€¢ Snowmen & Trees</title>
    <meta name="description" content="Winter AR using A-Frame Hit Test">

    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="hit-test-spawn.js"></script>

    <script>
      /* Shadow follower (unchanged from repo) */
      AFRAME.registerComponent('follow-shadow', {
        schema: {type: 'selector'},
        init() { this.el.object3D.renderOrder = -1; },
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y -= 0.001;
          }
        }
      });

      /* BONUS: spawn object on tap instead of moving one */
      AFRAME.registerComponent('spawn-on-tap', {
        init() {
          this.el.sceneEl.addEventListener('click', () => {
            const hitTarget = document.querySelector('#hit-target');
            if (!hitTarget.object3D.visible) return;

            const spawn = document.createElement('a-entity');
            spawn.setAttribute(
              'position',
              hitTarget.object3D.position
            );

            if (Math.random() > 0.5) {
              spawn.innerHTML = snowman();
            } else {
              spawn.innerHTML = tree();
            }

            this.el.sceneEl.appendChild(spawn);
          });
        }
      });

      /* Snowman made from spheres */
      function snowman() {
        return `
          <a-sphere radius="0.18" position="0 0.18 0" color="#FFFFFF"></a-sphere>
          <a-sphere radius="0.14" position="0 0.45 0" color="#FFFFFF"></a-sphere>
          <a-sphere radius="0.1"  position="0 0.68 0" color="#FFFFFF"></a-sphere>
        `;
      }

      /* Pine tree made from cones + cylinder */
      function tree() {
        return `
          <a-cylinder height="0.12" radius="0.04" color="#8B5A2B" position="0 0.06 0"></a-cylinder>
          <a-cone height="0.35" radius-bottom="0.25" color="#0B6623" position="0 0.3 0"></a-cone>
          <a-cone height="0.28" radius-bottom="0.2"  color="#0E7A2A" position="0 0.5 0"></a-cone>
          <a-cone height="0.22" radius-bottom="0.15" color="#149C3F" position="0 0.68 0"></a-cone>
        `;
      }
    </script>
  </head>

  <body>
    <a-scene
      reflection="directionalLight: a-light[type=directional]"
      ar-hit-test="target: #hit-target"
      renderer="colorManagement: true; exposure: 1; toneMapping: ACESFilmic"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr"
      spawn-on-tap
    >

      <!-- Lighting -->
      <a-light type="directional"
               light="castShadow:true"
               position="1 1 1"
               intensity="1.5"
               shadow-camera-automatic="#hit-target">
      </a-light>

      <!-- Camera -->
      <a-camera position="0 0.4 0"></a-camera>

      <!-- Invisible hit-test target (moves with plane detection) -->
      <a-entity
        id="hit-target"
        visible="false"
        shadow>
      </a-entity>

      <!-- Shadow receiver -->
      <a-plane
        follow-shadow="#hit-target"
        material="shader:shadow"
        shadow="cast:false"
        rotation="-90 0 0"
        width="3"
        height="3">
      </a-plane>

      <!-- Sky (hidden in AR) -->
      <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>

    </a-scene>
  </body>
</html>
